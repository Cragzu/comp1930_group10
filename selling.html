<!DOCTYPE html>
<html lang="en">

<head>
    <title>StudySource | Selling Product</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="style/stylesheet.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
</head>

<body>

<!--Our Scripts-->
<script src="scripts/firebase_setup.js"></script>
<script src="scripts/displayHeader.js"></script>
<!--Header should always be displayed first-->
<h1> Selling </h1>
<h4> Enter information about your book here. </h4>

<div id="bookSellingForm">
    <form>
        <div>
            <label for="bookTitle">
                Title of Book:
            </label>
            <input type="text" id="bookTitle" name="book_title"
                   placeholder="Writing In the Technical Fields 2nd Edition">
        </div>
        <div>
            <label for="author">
                Author:
            </label>
            <input type="text" id="authorName" name="author_name" placeholder="Thorsten Ewald">
        </div>
        <div>
            <label for="bookPrice">
                Price(CAD):
            </label>
            <input type="text" id="bookPrice" name="book_price" placeholder="50.50">
        </div>
        <div>
            <label for="bookDescription">
                Description:
            </label>
            <textarea id="bookDescription" name="book_desc" class="form-control md-textarea" rows="5"></textarea>

        </div>
        <div>
            <input type="button" id="listButton" value="Post Listing">
        </div>
    </form>
</div>

<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>

<script src="scripts/firebase_setup.js"></script>

<script>
    let userStatus;

    function listBook(author, title, price, description, seller) {

        console.log("This is the start of listing a book.");

        db.collection("books").add({
            Author: author,
            Title: title[0].toUpperCase() + title.slice(1),
            Price: price,
            Description: description,
            Seller: seller

        }).then(function () {
            window.alert("Your book was listed successfully!");
            window.location = "viewAccount.html";
        }).catch(function () {
            console.log("User has failed trying to list a book.");
        })
    }

    function checkTextBox() {
        // This function will check all the text boxes first before you can list a book
        let bookTitle = document.getElementById("bookTitle").value;
        let authorName = document.getElementById("authorName").value;
        let bookPrice = document.getElementById("bookPrice").value;
        let bookDescription = document.getElementById("bookDescription").value;
        let user = firebase.auth().currentUser;
        let userDisplay = user.displayName;

        if (bookTitle && !(/\d/.test(authorName)) && /^\d+$/.test(bookPrice) && bookDescription) {
            /*
            The conditions check is:
            1. Check if something is filled in for title
            2. Check if author name is only letters; this will automatically fail if nothing is filled in
            3. Check if bookPrice is a number or not. If the user has entered only numbers, but the text field has a space in it, the book will not be listed.
            4. If there is ANYTHING typed in the book description section it will pass
            */
            console.log("The user passed all the fields");
            // Once all the conditions are passed we can then give all of out data to the listBook function
            //This will take all of the data inputted and give it to the database
            listBook(authorName, bookTitle, bookPrice, bookDescription, userDisplay);
        } else {
            alert("At least one of the four fields has not been entered");
        }
    }


    function init() {
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                console.log(`A user is logged in: ${user.displayName}`)
            } else {
                console.log(`No user us logged in.`)
            }
        });
        document.getElementById("listButton").onclick = checkTextBox;
        // When you click the button it will check the fields before you can list the book.

    }

    init();

</script>
</body>

</html>