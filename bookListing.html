<!DOCTYPE html>
<html lang="en">

<head>
    <title>StudySource | Book Listing</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="style/stylesheet.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>

    <script src="scripts/firebase_setup.js"></script>
</head>

<body>
    <script src="scripts/displayHeader.js"></script>
    <!--Header should always be displayed first-->

    <div class="centerContainer">
        <div class="innerTextContainer">

            <div class="inlineContainer">
                <h2 id="bookTitle">[Book Title]</h2>
                <h2 id="bookAuthor">[Author Name]</h2>
            </div>

            <img class="bookImageListingPage"
                src="images/bookPlaceholder.jpg" />
            <h1 id="price">Price: $placeholder</h1>

            <h3 id="seller">Seller: [Seller Name]</h3>

            <p id="bookDescription">
                [Description of the book]
            </p>

            <div class="listingButtonContainer">
                <a href="shoppingCart.html">
                    <button type="button" class="btn btn-primary">View my Cart</button>
                </a>
                <a href="underConstruction.html">
                    <button type="button" class="btn btn-primary">Add to Cart</button>
                </a>
            </div>

        </div>
    </div>

    <script>
        let docId = localStorage.getItem("docId")

        function getCurrentData() {
            
            console.log(docId)
            // Print out and see if we actually got a proper document ID or not. Warning will be shown if docId fails to get overwritten

            let bookTitle = document.getElementById("bookTitle");
            let bookAuthor = document.getElementById("bookAuthor");
            let bookDesc = document.getElementById("bookDescription");
            let bookSeller = document.getElementById("seller");
            let bookPrice = document.getElementById("price");

            db.collection("books").doc(`${docId}`).onSnapshot(function (doc) {
                // Try to access the data if the docId change is working.


                console.log(doc.data());
                bookTitle.innerHTML = doc.data().Title;
                bookAuthor.innerHTML = `&nbsp;by ${doc.data().Author}`;
                bookDesc.innerHTML = `Description: ${doc.data().Description}`;
                bookSeller.innerHTML = `Seller: ${doc.data().Seller}`;
                bookPrice.innerHTML = `Price: &#36;${doc.data().Price}`;
                console.log("You have passed. You have accessed the document information.")
                console.log(`This is the document id: ${doc.data().docId}`)
                // This console log should print if we don't have any errors.
            })
        }

        // function addBookToCart(){
        //     let user = firebase.auth().currentUser;
        //     let userDisplay = user.displayName;
        //     db.collection('users').doc(`${user.displayName}`).collection("cart").doc(`${docId}`)
        // }

        function init() {
            // Run the functions in this script.
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    console.log(`There is a user logged in. User: ${user}`);
                    userStatus = true
                } else {
                    console.log(`No one is logged in`);
                    userStatus = false
                }
            })
            getCurrentData();
            // document.getElementById("addToCart").onclick = addBookToCart();
        }

        init();
    </script>

</body>
</html>